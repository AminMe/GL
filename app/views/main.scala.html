@(pageTitle: String, content: Html, scripts: Html)

<!DOCTYPE html>
<html>

    <head>

        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <title>@pageTitle</title>

        <link href="/css/bootstrap.min.css" rel="stylesheet">
        <link href="/font-awesome/css/font-awesome.css" rel="stylesheet">
        <link href="/css/plugins/toastr/toastr.min.css" rel="stylesheet">
        <link href="/js/plugins/gritter/jquery.gritter.css" rel="stylesheet">
        <link href="/css/animate.css" rel="stylesheet">

        <link href="/css/plugins/dataTables/dataTables.bootstrap.css" rel="stylesheet">
        <link href="/css/plugins/dataTables/dataTables.responsive.css" rel="stylesheet">
        <link href="/css/plugins/dataTables/dataTables.tableTools.min.css" rel="stylesheet">

        <link href="/css/plugins/awesome-bootstrap-checkbox/awesome-bootstrap-checkbox.css" rel="stylesheet">
        <link href="/css/plugins/footable/footable.core.css" rel="stylesheet">
        <link href="/css/plugins/chosen/chosen.css" rel="stylesheet">
        <link href="/css/plugins/iCheck/custom.css" rel="stylesheet">
        <link href="/css/plugins/colorpicker/bootstrap-colorpicker.min.css" rel="stylesheet">
        <link href="/css/plugins/cropper/cropper.min.css" rel="stylesheet">
        <link href="/css/plugins/switchery/switchery.css" rel="stylesheet">
        <link href="/css/plugins/jasny/jasny-bootstrap.min.css" rel="stylesheet">
        <link href="/css/plugins/nouslider/jquery.nouislider.css" rel="stylesheet">
        <link href="/css/plugins/datapicker/datepicker3.css" rel="stylesheet">
        <link href="/css/plugins/ionRangeSlider/ion.rangeSlider.css" rel="stylesheet">
        <link href="/css/plugins/ionRangeSlider/ion.rangeSlider.skinFlat.css" rel="stylesheet">
        <link href="/css/plugins/clockpicker/clockpicker.css" rel="stylesheet">
        <link href="/css/plugins/daterangepicker/daterangepicker-bs3.css" rel="stylesheet">
        <link href="/css/plugins/select2/select2.min.css" rel="stylesheet">
        <link href="/css/style.css" rel="stylesheet">

    </head>

    <body class="md-skin fixed-sidebar fixed-nav pace-done">
            <!--########### Start - Main HTML Content  ########### -->

        @content

            <!--########### End  - Main HTML Content  ########### -->


            <!-- Mainly scripts -->
        <script src="/assets/js/jquery-2.1.1.js"></script>
        <script src="/assets/js/bootstrap.min.js"></script>

        <script src="/assets/js/plugins/metisMenu/jquery.metisMenu.js"></script>
        <script src="/assets/js/plugins/slimscroll/jquery.slimscroll.min.js"></script>

            <!-- Flot -->
        <script src="/assets/js/plugins/flot/jquery.flot.js"></script>
        <script src="/assets/js/plugins/flot/jquery.flot.tooltip.min.js"></script>
        <script src="/assets/js/plugins/flot/jquery.flot.spline.js"></script>
        <script src="/assets/js/plugins/flot/jquery.flot.resize.js"></script>
        <script src="/assets/js/plugins/flot/jquery.flot.pie.js"></script>

            <!-- Peity -->
        <script src="/assets/js/plugins/peity/jquery.peity.min.js"></script>
        <script src="/assets/js/demo/peity-demo.js"></script>

            <!-- Custom and plugin javascript -->
        <script src="/assets/js/inspinia.js"></script>
        <script src="/assets/js/plugins/pace/pace.min.js"></script>

            <!-- jQuery UI -->
        <script src="/assets/js/plugins/jquery-ui/jquery-ui.min.js"></script>

            <!-- GITTER -->
        <script src="/assets/js/plugins/gritter/jquery.gritter.min.js"></script>

            <!-- Sparkline -->
        <script src="/assets/js/plugins/sparkline/jquery.sparkline.min.js"></script>

            <!-- Sparkline demo data  -->
        <script src="/assets/js/demo/sparkline-demo.js"></script>

            <!-- ChartJS-->
        <script src="/assets/js/plugins/chartJs/Chart.min.js"></script>

            <!-- Toastr -->
        <script src="/assets/js/plugins/toastr/toastr.min.js"></script>

            <!-- Data Tables -->
        <script src="/js/plugins/jeditable/jquery.jeditable.js"></script>
        <script src="/js/plugins/dataTables/jquery.dataTables.js"></script>
        <script src="/js/plugins/dataTables/dataTables.bootstrap.js"></script>
        <script src="/js/plugins/dataTables/dataTables.responsive.js"></script>
        <script src="/js/plugins/dataTables/dataTables.tableTools.min.js"></script>

            <!-- Footable -->
        <script src="/js/plugins/footable/footable.all.min.js"></script>

            <!-- DATE -->
        <script src="/assets/js/plugins/datapicker/bootstrap-datepicker.js"></script>
        <script src="/assets/js/plugins/datepicker/locales/bootstrap-datepicker.en.js"></script>
        <script src="/assets/js/plugins/datepicker/locales/bootstrap-datepicker.fr.js"></script>

            <!-- Chosen -->
        <script src="/js/plugins/chosen/chosen.jquery.js"></script>
            <!-- Exposing play framework routes -->
        <script type="text/javascript" src="@routes.Application.javascriptRoutes()"></script>

            <!-- JSKnob -->
        <script src="/js/plugins/jsKnob/jquery.knob.js"></script>

            <!-- Input Mask-->
        <script src="/js/plugins/jasny/jasny-bootstrap.min.js"></script>


            <!-- NouSlider -->
        <script src="/js/plugins/nouslider/jquery.nouislider.min.js"></script>

            <!-- Switchery -->
        <script src="/js/plugins/switchery/switchery.js"></script>

            <!-- IonRangeSlider -->
        <script src="/js/plugins/ionRangeSlider/ion.rangeSlider.min.js"></script>

            <!-- iCheck -->
        <script src="/js/plugins/iCheck/icheck.min.js"></script>

            <!-- MENU -->
        <script src="/js/plugins/metisMenu/jquery.metisMenu.js"></script>

            <!-- Color picker -->
        <script src="/js/plugins/colorpicker/bootstrap-colorpicker.min.js"></script>

            <!-- Clock picker -->
        <script src="/js/plugins/clockpicker/clockpicker.js"></script>

            <!-- Image cropper -->
        <script src="/js/plugins/cropper/cropper.min.js"></script>

            <!-- Date range use moment.js same as full calendar plugin -->
        <script src="/js/plugins/fullcalendar/moment.min.js"></script>

            <!-- Date range picker -->
        <script src="/js/plugins/daterangepicker/daterangepicker.js"></script>

            <!-- Select2 -->
        <script src="/js/plugins/select2/select2.full.min.js"></script>

            <!-- Nestable -->
        <script src="/js/plugins/nestable/jquery.nestable.js"></script>

            <!-- Projet -->
        <script src="/js/projet.js"></script>

            <!-- Menu -->
        <script src="/js/menu.js"></script>

        @scripts
        <script>

                var userRow;
                $requestUtilisateursArchives = false;
                $requestClientsArchives = false;
                $requestProjetsTermines = false;
                $requestProjetsArchives = false;
                var $tmpTr;
                var $tmpTrAdminClient;
                var $tmpTrAdminUser;

                $(document).on('click','#dataTables-admin-user tr td:not(:last-child)', function(){
                    var id = $(this).parent('tr').attr('value');
                    userRow = $(this).parent('tr');
                    console.log("id.on = "+id);
                    jsRoutes.controllers.AdminController.afficherModalUtilisateur(id).ajax({
                        success: function(utilisateur) {
                            //console.log(utilisateur);
                            /* fill modal values*/
                            $('#formLastName').val(utilisateur.nom);
                            $('#formFirstName').val(utilisateur.prenom);
                            $('#formEmail').val(utilisateur.email);
                            $('#formTel').val(utilisateur.telephone);

                            //TODO mettre la condition si !admin sinon
                            if(true)
                            {
                                // si le bouton a deja la classe ca sert a rien de changer
                                if(!$("#btnAdminNonModifier").hasClass("btn-active"))
                                {
                                    $("#btnAdminOuiModifier").removeClass("btn-active")
                                    $("#btnAdminNonModifier").addClass("btn-active");
                                }
                            }
                            else
                            {
                                if(!$("#btnAdminOuiModifier").hasClass("btn-active"))
                                {
                                    $("#btnAdminNonModifier").removeClass("btn-active")
                                    $("#btnAdminOuiModifier").addClass("btn-active");
                                }
                            }
                        },
                        //Case we have a problem
                        error: function(errorMessage){
                            alert(errorMessage);
                            console.log(errorMessage);
                        }
                    });
                });

                $(document).on('click','#dataTables-admin-projet tr td:not(:last-child)', function(){
                    var $valueTr = $(this).parent('tr').attr('value');
                    jsRoutes.controllers.AdminController.afficherAdminProjetsSelect($valueTr).ajax({
                        success: function(html) {
                            var result = $('#refresh',html);
                            $('#refresh').empty().html(result);
                        },
                        //Case we have a problem
                        error: function(errorMessage){
                            alert(errorMessage);
                        }
                    });
                });
                $(document).on('click','#dataTables-admin-client-body tr td:last-child', function(){

                    var parent = $(this).parent('tr');
                    var idC = parent.attr('value');
                    jsRoutes.controllers.AdminController.afficherModalClient(idC).ajax({
                        success: function(client){
                            $("#delete-project-name").empty();
                            $("#delete-project-name").append(client.nom);
                            $tmpTrAdminClient = parent;
                        }
                    });
                });

                $(document).on('click','#dataTables-admin-user tr td:last-child', function(){
                    $tmpTrAdminUser = $(this).parent('tr');

                    var idU = $tmpTrAdminUser.attr('value');
                    jsRoutes.controllers.AdminController.afficherModalUtilisateur(idU).ajax({
                        success: function(u){
                            $("#delete-utilisateur-name").empty();
                            $("#delete-utilisateur-name").append(" "+u.prenom+" "+u.nom+" ("+u.email+")");
                            $("#delete-utilisateur-name-confirm").empty();
                            $("#delete-utilisateur-name-confirm").append(" "+u.prenom+" "+u.nom+" ("+u.email+")");
                            jsRoutes.controllers.UtilisateurController.afficherUtilisateursNonArchives().ajax({
                               success: function(utilisateurs){
                                 console.log(utilisateurs);
                                   jsRoutes.controllers.UtilisateurController.listProjetsUtilisateur(idU).ajax({
                                       success: function(listProjets){
                                           console.log(listProjets);
                                           //listProjets
                                           var projetTableBody = $('#table-modal-suppr-user-projet-body');
                                           projetTableBody.empty();

                                           var p ="";
                                           if(listProjets.length != 0){
                                               $(listProjets).each(function(index, projet) {
                                                   p+=('<tr value="'+projet.id+'">');
                                                   p+=('<td>'+projet.nom+'</td>');
                                                   if(utilisateurs.length != 0){
                                                       p+=('<td><select class="form-control select2-respo-projet" style="width:100%;" multiple="single">');
                                                       $(utilisateurs).each(function(index,u){
                                                           // lister tous les utilisaturs en cours sauf l'user courant
                                                           if(u.id != idU){
                                                               p+=('<option value="'+u.id+'">'+u.nom+' '+u.prenom+' ('+u.email+')</option>');
                                                           }//console.log(u.nom);
                                                       });
                                                       p+=('</select></td>');
                                                   }
                                                   p+=('</tr>');

                                               });
                                               projetTableBody.append(p);
                                               p = "";
                                           }
                                       }
                                   });

                                   jsRoutes.controllers.UtilisateurController.listTachesUtilisateur(idU).ajax({
                                       success: function(listTaches){
                                           console.log(listTaches);
                                           var tacheeBody = $('#table-modal-suppr-user-tache-body');
                                           tacheeBody.empty();

                                           var p="";
                                           if(listTaches.length != 0){
                                               $(listTaches).each(function(index, tache) {
                                                   p+=('<tr value="'+tache.id+'">');
                                                   p+=('<td>'+tache.nom+'</td>');
                                                   p+=('<td>'+tache.projet.nom+'</td>');
                                                   if(utilisateurs.length != 0){
                                                       p+=('<td><select class="form-control select2-respo-tache" style="width:100%;" multiple="single">');
                                                       $(utilisateurs).each(function(index,u){
                                                           // lister tous les utilisaturs en cours sauf l'user courant
                                                           if(u.id != idU){
                                                               p+=('<option value="'+u.id+'">'+u.nom+' '+u.prenom+' ('+u.email+')</option>');
                                                           }//console.log(u.nom);
                                                       });
                                                       p+=('</select></td>');
                                                   }
                                                   p+=('</tr>');

                                               });
                                               tacheeBody.append(p);
                                               p = "";
                                           }
                                       }
                                   });
                               }
                            });
                        }
                    });
                });



                $(document).on('click','#dataTables-admin-client tr td:not(:last-child)', function(){
                    var idC = $(this).parent('tr').attr('value');

                    jsRoutes.controllers.AdminController.afficherModalClient(idC).ajax({
                        success: function(client) {
                            //console.log(client);
                            console.log("client : "+client)
                            $("#dataTables-admin-client").dataTable().fnDestroy();

                            $('#formClientName').val(client.nom);
                            $('#formClientAdress').val(client.adresseClient.adresse);
                            $('#formZipCode').val(client.adresseClient.zipCode);
                            $('#formCity').val(client.adresseClient.ville);
                            $('#formCountry').val(client.adresseClient.pays);

                            $('#client-priority-1').removeClass("btn-active");
                            $('#client-priority-2').removeClass("btn-active");
                            $('#client-priority-3').removeClass("btn-active");
                            $('#client-priority-'+client.priorite).addClass("btn-active");
                            jsRoutes.controllers.ProjetController.afficherProjetsClient(idC).ajax({
                                success: function(listProjets) {
                                    console.log("sucess -----");
                                    var projetTableBody = $('#table-modal-client-projets-body');
                                    projetTableBody.empty();
                                    console.log(listProjets);
                                    $("#dataTables-admin-client").dataTable().fnDestroy();
                                    if(listProjets.length != 0){
                                        $(listProjets).each(function(index, projet) {
                                            var p ="";
                                            p+=('<tr>');
                                            p+=('<td class="first-td">'+projet.nom+'</td>');
                                            p+=('<td class="td-btn-suppr" style="vertical-align:middle;"><i class="fa fa-times"></i></td>');
                                            p+=('</tr>');

                                            projetTableBody.append(p);
                                        });
                                    }
                                },
                                error: function(errorMessage){
                                    console.log("error : "+errorMessage)
                                }
                            });
                            jsRoutes.controllers.ContactController.afficherContactsClient(idC).ajax({
                                success: function(listContacts) {
                                    var contactsTableBody = $('#table-modal-client-contacts-body');
                                    contactsTableBody.empty();
                                    console.log(listContacts);
                                    $("#dataTables-admin-client").dataTable().fnDestroy();
                                    if(listContacts.length != 0){
                                        $(listContacts).each(function(index, contact) {
                                            var c ="";
                                            c+=('<tr>');
                                            c+=('<td class="first-td">'+contact.nom+ " "+ contact.prenom+'</td>');
                                            c+=('<td class="td-btn-suppr" style="vertical-align:middle;"><i class="fa fa-times"></i></td>');
                                            c+=('</tr>');

                                            contactsTableBody.append(c);
                                        });
                                    }
                                },
                                error: function(errorMessage){
                                    console.log("error : "+errorMessage)
                                }
                            });


                        },
                        //Case we have a problem
                        error: function(errorMessage){
                            alert(errorMessage);
                        }
                    });
                });
                //dataTables-admin-client





                var supprimerProjet = function(){
                    var $value = $tmpTr.attr('value');
                    console.log($value);
                    jsRoutes.controllers.AdminController.supprimerProjet($value).ajax({
                        success: function(html) {
                            $('#dataTables-admin-projet').dataTable().fnDestroy();
                            $tmpTr.remove();
                        },
                        error: function(errorMessage,codeerror){
                            alert(errorMessage);
                            alert(codeerror);
                        }
                    });
                }

                var supprimerClient = function(){
                    var $value = $tmpTrAdminClient.attr('value');
                    console.log($value);
                    jsRoutes.controllers.AdminController.supprimerClient($value).ajax({
                        success: function(html) {
                            $('#dataTables-admin-client').dataTable().fnDestroy();
                            if( $('#checkBoxClientsArchived').is(":checked")) {
                                $tmpTrAdminClient.addClass("archived");
                                $tmpTrAdminClient.children('td').eq(6).empty();
                                $tmpTrAdminClient.children('td').eq(6).html('@Messages("yes")');
                                $tmpTrAdminClient.children('td').eq(7).removeClass('td-modal')
                                $tmpTrAdminClient.children('td').eq(7).addClass('td-btn-suppr-disable')
                            }else{
                                $tmpTrAdminClient.remove();
                            }
                        },
                        error: function(errorMessage){
                            alert(errorMessage);
                        }
                    });
                }

                var supprimerUtilisateur = function(){
                    var idUtilisateur = $tmpTrAdminUser.attr('value');
                    console.log(idUtilisateur);

                }

                var afficherNotifications = function () {
                    //e.preventDefault();
                    jsRoutes.controllers.NotificationController.afficherNotifications().ajax({
                        success: function(html) {
                            var result = $('#refresh',html).html();
                            $('#refresh').empty().html(result);

                        },
                        //Case we have a problem
                        error: function(errorMessage){
                            alert(errorMessage);
                        }
                    });
                }


                /**
                 * Methode Ajax pour aller récuperer des informations d'un utilisateur
                 **/
                var afficherModalUtilisateur = function (t) {

                    var id = $(t).attr('value');
                    jsRoutes.controllers.AdminController.afficherModalUtilisateur(id).ajax({
                        success: function(utilisateur) {
                            //console.log(utilisateur);
                            $("#dataTables-admin-user").dataTable().fnDestroy();
                            /* fill modal values*/
                            $('#formLastName').val(utilisateur.nom);
                            $('#formFirstName').val(utilisateur.prenom);
                            $('#formEmail').val(utilisateur.email);
                            $('#formTel').val(utilisateur.telephone);
                        },
                        //Case we have a problem
                        error: function(errorMessage){
                            alert(errorMessage);
                        }
                    });
                }

                var creerUtilisateur = function(btn)
                {
                    var form = $(btn).attr("form");
                    form = "#"+form;
                    var serialize = $(form).serialize();
                    var value = "Non";
                    if($("#btnAdminOuiCreer").hasClass("btn-active"))
                    {
                        value = "Oui";
                    }
                    console.log("value : "+value);
                    jsRoutes.controllers.UtilisateurController.creerUtilisateur().ajax({
                        data: serialize+"&admin="+value,
                        success : function(data) {
                            $("#errorCreerUserP").empty();
                            $("#errorCreerUser").hide();

                            $(form)[0].reset();
                            console.log("data return = "+data.nom);

                            var utilisateurList = $('#dataTables-admin-user-body');
                            $("#dataTables-admin-user").dataTable().fnDestroy();

                            var utilisateur = data;
                            var list = generateRowUtilisateur(utilisateur);
                            utilisateurList.append(list);

                            $("#successCreerUserP").html('@Messages("user") '+utilisateur.nom+ ' ' + utilisateur.prenom + ' @Messages("created")');
                            $("#successCreerUser").show();
                            setTimeout(function(){
                                $("#successCreerUser").hide();
                            },4000);
                        },
                        error: function(errorMessage){
                            console.log(errorMessage);
                            $("#successCreerUser").hide();
                            $("#successCreerUserP").empty();

                            var messageDiv = generateErrorUtilisateur(errorMessage);

                            $("#errorCreerUserP").html(messageDiv);
                            $("#errorCreerUser").show();
                        }
                    })
                }

                function generateErrorUtilisateur(errorMessage)
                {
                    var messageDiv = '@Messages("errors") : ';
                    if(errorMessage.responseJSON.nomVide==true)
                    {
                        messageDiv += '<br> - @Messages("lastnameEmptyError")';
                    }
                    else if(errorMessage.responseJSON.nomTropLong==true)
                    {
                        messageDiv += '<br> - @Messages("lastnameTooLongError")';
                    }
                    else if(errorMessage.responseJSON.nomIncorrect==true)
                    {
                        messageDiv += '<br> - @Messages("lastnameIncorrectError")';
                    }

                    if(errorMessage.responseJSON.prenomVide==true)
                    {
                        messageDiv += '<br> - @Messages("firstnameEmptyError")';
                    }
                    else if(errorMessage.responseJSON.prenomTropLong==true)
                    {
                        messageDiv += '<br> - @Messages("firstnameTooLongError")';
                    }
                    else if(errorMessage.responseJSON.prenomIncorrect==true)
                    {
                        messageDiv += '<br> - @Messages("firstnameIncorrectError")';
                    }


                    if(errorMessage.responseJSON.emailVide==true)
                    {
                        messageDiv += '<br> - @Messages("emailEmptyError")';
                    }
                    else if(errorMessage.responseJSON.emailIncorrecte==true)
                    {
                        messageDiv += '<br> - @Messages("emailIncorrectError")';
                    }
                    else if(errorMessage.responseJSON.emailTropLong==true)
                    {
                        messageDiv += '<br> - @Messages("emailTooLongError")';
                    }

                    if(errorMessage.responseJSON.telVide==true)
                    {
                        messageDiv += '<br> - @Messages("telEmptyError")';
                    }
                    else if(errorMessage.responseJSON.telIncorrecte==true)
                    {
                        messageDiv += '<br> - @Messages("telIncorrectError")';
                    }
                    else if(errorMessage.responseJSON.telTropLong==true)
                    {
                        messageDiv += '<br> - @Messages("telTooLongError")';
                    }

                    if(errorMessage.responseJSON.userExist)
                    {
                        messageDiv += '<br> - /!\\ @Messages("emailAlreadyUsed")';
                    }
                    return messageDiv;
                }

                function generateRowUtilisateur(utilisateur)
                {
                    var list ="";
                    list+=('<tr class="archived" value='+utilisateur.id+'>');
                    list+=('<td class="td-modal" data-toggle="modal" data-target="#modal-modif-user">'+utilisateur.nom+'</td>');
                    list+=('<td class="td-modal" data-toggle="modal" data-target="#modal-modif-user">'+utilisateur.prenom+'</td>');
                    list+=('<td class="td-modal" data-toggle="modal" data-target="#modal-modif-user">'+utilisateur.email+'</td>');
                    list+=('<td class="td-modal" data-toggle="modal" data-target="#modal-modif-user">'+utilisateur.telephone+'</td>');
                    list+=('<td class="td-modal" data-toggle="modal" data-target="#modal-modif-user">'+utilisateur.listProjetsResponsableSize+'</td>');
                    list+=('<td class="td-modal" data-toggle="modal" data-target="#modal-modif-user">'+utilisateur.listTachesSize+'</td>');
                    list+=('<td class="td-modal" data-toggle="modal" data-target="#modal-modif-user">@Messages("no")</td>');
                    list+=('<td class="td-btn-suppr" style="vertical-align:middle ;" data-toggle="modal" data-target="#modal-suppr-user"><i class="fa fa-times"></i></td>');
                    list+=('</tr>');

                    return list;
                }



                var modifierUtilisateur = function(btn)
                {
                    var form = $(btn).attr("form");
                    form = "#"+form;
                    var serialize = $(form).serialize();
                    var value = "Non";
                    if($("#btnAdminOuiModifier").hasClass("btn-active"))
                    {
                        value = "Oui";
                    }
                    var idUtilisateur = userRow.attr('value');

                    console.log("value : "+value);
                    jsRoutes.controllers.UtilisateurController.modifierUtilisateur(idUtilisateur).ajax({
                        data: serialize+"&admin="+value,
                        success : function(data) {
                            $("#errorModifierUserP").empty();
                            $("#errorModifierUser").hide();


                            console.log("data return = "+data.nom);

                            var utilisateurList = $('#dataTables-admin-user-body');
                            $("#dataTables-admin-user").dataTable().fnDestroy();
                            userRow.remove();

                            var utilisateur = data;

                            var list = generateRowUtilisateur(utilisateur);

                            utilisateurList.append(list);

                            $("#successModifierUserP").html('@Messages("user") '+utilisateur.nom+ ' ' + utilisateur.prenom + ' @Messages("modified")');
                            $("#successModifierUser").show();
                            setTimeout(function(){
                                $("#successModifierUser").hide();
                            },4000);
                        },
                        error: function(errorMessage){
                            console.log(errorMessage);
                            $("#successModifierUser").hide();
                            $("#successModifierUserP").empty();

                            var messageDiv = generateErrorUtilisateur(errorMessage);

                            $("#errorModifierUserP").html(messageDiv);
                            $("#errorModifierUser").show();
                        }
                    });
                }

                var modifierUtilisateur = function(btn)
                {
                    var form = $(btn).attr("form");
                    form = "#"+form;
                    var serialize = $(form).serialize();
                    var value = "Non";
                    if($("#btnAdminOuiModifier").hasClass("btn-active"))
                    {
                        value = "Oui";
                    }
                    var idUtilisateur = userRow.attr('value');

                    console.log("value : "+value);
                    jsRoutes.controllers.UtilisateurController.modifierUtilisateur(idUtilisateur).ajax({
                        data: serialize+"&admin="+value,
                        success : function(data) {
                            $("#errorModifierUserP").empty();
                            $("#errorModifierUser").hide();


                            console.log("data return = "+data.nom);

                            var utilisateurList = $('#dataTables-admin-user-body');
                            $("#dataTables-admin-user").dataTable().fnDestroy();
                            userRow.remove();

                            var utilisateur = data;

                            var list = generateRowUtilisateur(utilisateur);

                            utilisateurList.append(list);

                            $("#successModifierUserP").html('@Messages("user") '+utilisateur.nom+ ' ' + utilisateur.prenom + ' @Messages("modified")');
                            $("#successModifierUser").show();
                            setTimeout(function(){
                                $("#successModifierUser").hide();
                            },4000);
                        },
                        error: function(errorMessage){
                            console.log(errorMessage);
                            $("#successModifierUser").hide();
                            $("#successModifierUserP").empty();

                            var messageDiv = generateErrorUtilisateur(errorMessage);

                            $("#errorModifierUserP").html(messageDiv);
                            $("#errorModifierUser").show();
                        }
                    });
                }
                $.fn.serializeObject = function()
                {
                    var o = {};
                    var a = this.serializeArray();
                    $.each(a, function() {
                        if (o[this.name] !== undefined) {
                            if (!o[this.name].push) {
                                o[this.name] = [o[this.name]];
                            }
                            o[this.name].push(this.value || '');
                        } else {
                            o[this.name] = this.value || '';
                        }
                    });
                    return o;
                };
                var creerClient = function(btn)
                {
                    var form = $(btn).attr("form");
                    form = "#"+form;
                    var serialize = $(form).serializeObject();
                    //var myRows = { myRows: [] };
                    var value = $(".btn-active").attr('value');
                    var $th = $('#tableContact th');

                    var rowCount = $('#tableContact tbody tr').length;
                    if(rowCount != 0){
                        var tbl = $('#tableContact tr:has(td)').map(function(i, v) {
                            var $td =  $('td', this);
                            return {
                                Nom: $td.eq(0).text(),
                                Prenom: $td.eq(1).text(),
                                Email: $td.eq(2).text(),
                                Tel :$td.eq(3).text()
                            }
                        }).get();
                        var json = "{\"form\":"+JSON.stringify(serialize)+",\"table\":"+JSON.stringify(tbl)+",\"priorite\":"+value+"}";
                    }else{
                        var json = "{\"form\":"+JSON.stringify(serialize)+",\"priorite\":"+value+"}";
                    }

                    jsRoutes.controllers.ClientController.creerClient().ajax({
                        data: json,
                        contentType: "application/json",

                        success : function(data) {
                            $("#errorCreerClientP").empty();
                            $("#errorCreerClient").hide();

                            $("#successCreerClientP").html('@Messages("client") '+data.nom+' @Messages("created")');
                            $("#successCreerClient").show();
                            setTimeout(function(){
                                $("#successCreerClient").hide();
                            },4000);

                            $(form)[0].reset();
                            $('#tableContact tr:not(:first)').remove();
                            $('#listContactAjout').hide();

                            var clientList = $('#dataTables-admin-client-body');
                            $("#dataTables-admin-client").dataTable().fnDestroy();

                            var utilisateur = data;
                            var list = generateRowClient(data);
                            clientList.append(list);

                        },
                        error: function(errorMessage){
                            $("#successCreerClient").hide();
                            $("#successCreerClientP").empty();

                            var messageDiv = generateErrorCreerClient(errorMessage);

                            $("#errorCreerClientP").html(messageDiv);
                            $("#errorCreerClient").show();
                        }
                    });
                }

                function generateRowClient(client)
                {
                    var list;
                    list+=('<tr value='+client.id+'>');
                    list+=('<td class="td-modal" data-toggle="modal" data-target="#modal-modif-client">'+client.nom+'</td>');
                    list+=('<td class="td-modal" data-toggle="modal" data-target="#modal-modif-client">'+
                    client.adresseClient.adresse+", "+client.adresseClient.zipCode+", "+client.adresseClient.ville+", "+client.adresseClient.pays+
                    '</td>');
                    list+=('<td class="td-modal" data-toggle="modal" data-target="#modal-modif-client">'+client.listContactsSize+'</td>');
                    list+=('<td class="td-modal" data-toggle="modal" data-target="#modal-modif-client">'+client.listProjetsSize+'</td>');
                    list+=('<td class="td-modal" data-toggle="modal" data-target="#modal-modif-client">'+client.listTachesSize+'</td>');
                    list+=('<td class="td-modal" data-toggle="modal" data-target="#modal-modif-client">'+client.priorite+'</td>');
                    list+=('<td class="td-modal" data-toggle="modal" data-target="#modal-modif-client">@Messages("no")</td>');
                    list+=('<td class="td-btn-suppr-disable" style="vertical-align:middle;" data-toggle="modal"><i class="fa fa-times"></i></td>');
                    list+=('</tr>');
                    return list;
                }

                function generateErrorCreerClient(errorMessage)
                {
                    alert(errorMessage);
                    var messageDiv = '@Messages("errors") : ';

                    if(errorMessage.responseJSON.nomClientVide==true)
                    {
                        messageDiv += '<br> - @Messages("nameClientEmptyError")';
                    }
                    else if(errorMessage.responseJSON.nomClientTropLong==true)
                    {
                        messageDiv += '<br> - @Messages("nameClientTooLongError")';
                    }
                    else if(errorMessage.responseJSON.nomClientIncorrecte==true)
                    {
                        messageDiv += '<br> - @Messages("nameClientIncorrectError")';
                    }

                    if(errorMessage.responseJSON.adresseVide==true)
                    {
                        messageDiv += '<br> - @Messages("adressEmptyError")';
                    }
                    else if(errorMessage.responseJSON.adresseTropLong==true)
                    {
                        messageDiv += '<br> - @Messages("adressTooLongError")';
                    }
                    if(errorMessage.responseJSON.codePostalVide==true)
                    {
                        messageDiv += '<br> - @Messages("zipEmptyError")';
                    }
                    else if(errorMessage.responseJSON.codePostalTropLong==true)
                    {
                        messageDiv += '<br> - @Messages("zipTooLongError")';
                    }
                    if(errorMessage.responseJSON.villeVide==true)
                    {
                        messageDiv += '<br> - @Messages("cityEmptyError")';
                    }
                    else if(errorMessage.responseJSON.villeTropLong==true)
                    {
                        messageDiv += '<br> - @Messages("cityTooLongError")';
                    }
                    if(errorMessage.responseJSON.paysVide==true)
                    {
                        messageDiv += '<br> - @Messages("stateEmptyError")';
                    }
                    else if(errorMessage.responseJSON.paysTropLong==true)
                    {
                        messageDiv += '<br> - @Messages("stateTooLongError")';
                    }

                    if(errorMessage.responseJSON.clientExiste)
                    {
                        messageDiv += '<br> - /!\\ @Messages("clientExistError")';
                    }
                    return messageDiv;
                }


                var supprContact = function(td){
                    var tr = $(td).parent('tr');
                    tr.remove();
                    var rowCount = $('#tableContact tbody tr').length;
                    if(rowCount == 0){
                        $('#listContactAjout').hide();
                    }
                }
                var creerContact = function(btn)
                {
                    console.log("ICI");
                    var form = $(btn).attr("form");
                    form = "#"+form;
                    var serialize = $(form).serialize();
                    console.log(serialize);
                    jsRoutes.controllers.ClientController.contactCheck().ajax({
                        data: serialize,
                        success : function(data) {
                            var $email = data.email;
                            var $length = $('#listContactAjout tr > td:contains('+$email+')').length;
                            if($length>0){
                                $("#successCreerClient").hide();
                                $("#successCreerClientP").empty();
                                var messageDiv = '<br> - /!\\ @Messages("emailAlreadyUsed")';
                                $("#errorCreerClientP").html(messageDiv);
                                $("#errorCreerClient").show();
                            }else{
                                $("#errorCreerClientP").empty();
                                $("#errorCreerClient").hide();

                                $("#successCreerClientP").html('@Messages("contact") '+data.nom+ ' ' + data.prenom + ' @Messages("created")');
                                $("#successCreerClient").show();

                                if ($('#listContactAjout').not(':visible')){
                                    $('#listContactAjout').show();
                                }
                                setTimeout(function(){
                                    $("#successCreerClient").hide();
                                },4000);
                                var contact = $('#tableContact tbody');
                                var list ="";

                                list+=('<tr>');
                                list+=('<td class="first-td">'+data.nom+'</td>');
                                list+=('<td class="first-td">'+data.prenom+'</td>');
                                list+=('<td class="first-td">'+data.email+'</td>');
                                list+=('<td class="first-td">'+data.telephone+'</td>');
                                list+=('<td class="td-btn-suppr" style="vertical-align:middle;" onclick="supprContact(this)"><i class="fa fa-times"></i></td>');
                                list+=('</tr>');
                                contact.append(list);
                                $(form)[0].reset();

                            }
                        },
                        error: function(errorMessage){
                            $("#successCreerClient").hide();
                            $("#successCreerClientP").empty();
                            var messageDiv = generateErrorCreerClientContact(errorMessage);
                            $("#errorCreerClientP").html(messageDiv);
                            $("#errorCreerClient").show();
                        }
                    });
                }

                function generateErrorCreerClientContact(errorMessage)
                {
                    var messageDiv = '@Messages("errors") : ';

                    if(errorMessage.responseJSON.nomVideContact==true)
                    {
                        messageDiv += '<br> - @Messages("lastnameEmptyError")';
                    }
                    else if(errorMessage.responseJSON.nomTropLongContact==true)
                    {
                        messageDiv += '<br> - @Messages("lastnameTooLongError")';
                    }
                    else if(errorMessage.responseJSON.nomIncorrectContact==true)
                    {
                        messageDiv += '<br> - @Messages("lastnameIncorrectError")';
                    }

                    if(errorMessage.responseJSON.prenomVideContact==true)
                    {
                        messageDiv += '<br> - @Messages("firstnameEmptyError")';
                    }
                    else if(errorMessage.responseJSON.prenomTropLongContact==true)
                    {
                        messageDiv += '<br> - @Messages("firstnameTooLongError")';
                    }
                    else if(errorMessage.responseJSON.prenomIncorrectContact==true)
                    {
                        messageDiv += '<br> - @Messages("firstnameIncorrectError")';
                    }


                    if(errorMessage.responseJSON.emailVideContact==true)
                    {
                        messageDiv += '<br> - @Messages("emailEmptyError")';
                    }
                    else if(errorMessage.responseJSON.emailIncorrecteContact==true)
                    {
                        messageDiv += '<br> - @Messages("emailIncorrectError")';
                    }
                    else if(errorMessage.responseJSON.emailTropLongContact==true)
                    {
                        messageDiv += '<br> - @Messages("emailTooLongError")';
                    }

                    if(errorMessage.responseJSON.telVideContact==true)
                    {
                        messageDiv += '<br> - @Messages("telEmptyError")';
                    }
                    else if(errorMessage.responseJSON.telIncorrecteContact==true)
                    {
                        messageDiv += '<br> - @Messages("telIncorrectError")';
                    }
                    else if(errorMessage.responseJSON.telTropLongContact==true)
                    {
                        messageDiv += '<br> - @Messages("telTooLongError")';
                    }

                    return messageDiv;
                }

                var afficherAdminProjets = function(){
                    jsRoutes.controllers.AdminController.afficherAdminProjets().ajax({
                        success: function(html) {
                            var result = $('#refresh',html);
                            $('#refresh').empty().html(result);
                        },
                        error: function(errorMessage){
                            alert(errorMessage);
                        }
                    });
                }

                var afficherModalTache = function (t) {

                    var idTache = $(t).attr('value');

                    jsRoutes.controllers.DashboardController.afficherModalTache(idTache).ajax({
                        success: function(tache) {
                            $("#dataTables-tdb-tache").dataTable().fnDestroy();

                            // div-consulter-tache
                            if(tache.critique){
                                $('#imgCritique-consulterTache-tdb').show();
                            }
                            else{
                                $('#imgCritique-consulterTache-tdb').hide();
                            }

                            $('#idTache-consulter-tdb').html(tache.idTache);
                            $('#idTache-modifier-tdb').html(tache.idTache);
                            $('#nomTache-consulter-tdb').html(tache.nom);
                            $('#formModifierNomTache-tdb').val(tache.nom);
                            $('#descriptionTache-consulter-tdb').html(tache.description);
                            $('#formModifierDescriptionTache-tdb').val(tache.description);
                            if(tache.predecesseur == null){
                                $('#titre-predecesseur-consulter-tdb').hide()
                                $('#table-predecesseurTache-consulter-tdb').hide();
                            }
                            else{
                                $('#titre-predecesseur-consulter-tdb').show()
                                $('#table-predecesseurTache-consulter-tdb').show();
                                $('#table-predecesseurTache-consulter-tdb table tbody tr .id-task').html(tache.predecesseur.idTache);
                                $('#table-predecesseurTache-consulter-tdb table tbody tr .name-task').html(tache.predecesseur.nom);
                            }

                            // TODO : Successeurs


                            $('#nomProjet-consulter-tdb').html(tache.projet.nom);
                            $('#nomClient-consulter-tdb').html(tache.projet.client.nom);
                            $('#nomRespTache-consulter-tdb').html(tache.responsableTache.prenom + " " + tache.responsableTache.nom);


                            // div-modifier-tache


                            /* Look for Projects and contacts
                             jsRoutes.controllers.ProjetController.afficherProjetsClient(idTache).ajax({
                             success: function(listProjets) {
                             console.log("sucess -----");
                             var projetTableBody = $('#table-modal-client-projets-body');
                             projetTableBody.empty();
                             console.log(listProjets);
                             $("#dataTables-tdb-tache").dataTable().fnDestroy();
                             if(listProjets.length != 0){
                             $(listProjets).each(function(index, projet) {
                             var p ="";
                             p+=('<tr>');
                             p+=('<td class="first-td">'+projet.nom+'</td>');
                             p+=('<td class="td-btn-suppr" style="vertical-align:middle;"><i class="fa fa-times"></i></td>');
                             p+=('</tr>');

                             projetTableBody.append(p);
                             });
                             }
                             },
                             error: function(errorMessage){
                             console.log("error : "+errorMessage)
                             }
                             });
                             jsRoutes.controllers.ContactController.afficherContactsClient(idTache).ajax({
                             success: function(listContacts) {
                             var contactsTableBody = $('#table-modal-client-contacts-body');
                             contactsTableBody.empty();
                             //console.log(listContacts);
                             $("#dataTables-tdb-tache").dataTable().fnDestroy();
                             if(listContacts.length != 0){
                             $(listContacts).each(function(index, contact) {
                             var c ="";
                             c+=('<tr>');
                             c+=('<td class="first-td">'+contact.nom+ " "+ contact.prenom+'</td>');
                             c+=('<td class="td-btn-suppr" style="vertical-align:middle;"><i class="fa fa-times"></i></td>');
                             c+=('</tr>');

                             contactsTableBody.append(c);
                             });
                             }
                             }
                             });*/


                        },
                        //Case we have a problem
                        error: function(errorMessage){
                            alert(errorMessage);
                        }
                    });
                }


                $(document).ready(function () {


                    $('#dataTables-admin-user').DataTable({
                        destroy:true,
                        "columnDefs": [{
                            "searchable": false,
                            "orderable": false,
                            "targets":7,
                        } ]
                    });


                    $('#dataTables-admin-client').DataTable({
                        destroy: true,
                        "columnDefs": [{
                            "searchable": false,
                            "orderable": false,
                            "targets":6
                        } ]
                    });

                    $('#sidebar-back-select').click(function(){
                        alert("JS : #sidebar-back-select");
                    });

                    $( "#btn-modifierProjet-admin" ).click(function() {
                        //$("#div-consulterProjet").css("display","none");

                        jQuery.fx.off = true;
                        $("#div-consulterProjet-admin").hide();
                        $("#div-modifierProjet-admin").show();
                        jQuery.fx.off = false;
                    });

                    $( "#btn-cancel-modifierProjet-admin" ).click(function() {
                        jQuery.fx.off = true;
                        $("#div-modifierProjet-admin").hide();
                        $("#div-consulterProjet-admin").show();
                        jQuery.fx.off = false;
                    });

                    $( "#btn-modifierProjet-client" ).click(function() {
                        //$("#div-consulterProjet").css("display","none");
                        jQuery.fx.off = true;
                        $("#div-consulterProjet-client").hide();
                        $("#div-modifierProjet-client").show();
                        jQuery.fx.off = false;
                    });

                    $( "#btn-cancel-modifierProjet-client" ).click(function() {
                        jQuery.fx.off = true;
                        $("#div-modifierProjet-client").hide();
                        $("#div-consulterProjet-client").show();
                        jQuery.fx.off = false;
                    });

                    function modeDraftProjet()
                    {
                        if($('#checkbox-draft-projet').is(':checked')){
                            $('#nestable-projet').removeClass("dd-nodrag");
                            $('.id-tache').hide();
                        }
                        else{
                            $('#nestable-projet').addClass("dd-nodrag");
                            $('.id-tache').show();
                        }
                    }
                    modeDraftProjet();
                    $('#checkbox-draft-projet').click(function() {
                        modeDraftProjet();
                    });

                    function modeDraftClient()
                    {
                        if($('#checkbox-draft-client').is(':checked')){
                            $('#nestable-client').removeClass("dd-nodrag");
                            $('.id-tache').hide();
                        }
                        else{
                            $('#nestable-client').addClass("dd-nodrag");
                            $('.id-tache').show();
                        }
                    }
                    modeDraftClient();
                    $('#checkbox-draft-client').click(function() {
                        modeDraftClient();
                    });

                    function modeDraftProjetAdmin()
                    {
                        if($('#checkbox-draft-projet-admin').is(':checked')){
                            $('#nestable-projet-admin').removeClass("dd-nodrag");
                            $('.id-tache').hide();
                        }
                        else{
                            $('#nestable-projet-admin').addClass("dd-nodrag");
                            $('.id-tache').show();
                        }
                    }
                    modeDraftProjetAdmin();
                    $('#checkbox-draft-projet-admin').click(function() {
                        modeDraftProjetAdmin();
                    });


                    $(".select2-input").select2();

                    $(".select2-predecesseur").select2({
                        placeholder : '@Messages("choosePredecessor")...',
                        maximumSelectionLength: 1
                    });

                    $(".select2-successeur").select2({
                        placeholder : '@Messages("chooseSuccessor")...'
                    });
                    $(".select2-client").select2({
                        placeholder : '@Messages("chooseClient")...',
                        maximumSelectionLength: 1
                    });

                    $(".select2-respo-projet").select2({
                        placeholder : '@Messages("chooseProjectManager")...',
                        maximumSelectionLength: 1
                    });
                    $(".select2-respo-tache").select2({
                        placeholder : '@Messages("chooseTaskResponsible")...',
                        maximumSelectionLength: 1
                    });




                    $('.datatable-consulterClient').DataTable();
                    $('.dataTables-example').DataTable();

                    $('#projet_Tache').dataTable( {
                        "ordering": false
                    } );

                    $('#projet_Projet').dataTable( {
                        "ordering": false
                    } );

                    $('#dataTables-tdb-projet').DataTable();

                    $('#dataTables-tdb-tache').DataTable({
                        "columnDefs": [{
                            "searchable": false,
                            "orderable": false,
                            "targets": [6, 7]
                        } ]
                    });

                    $('#dataTables-admin-projet').DataTable({
                        "columnDefs": [{
                            "searchable": false,
                            "orderable": false,
                            "targets":6
                        } ]
                    });



                    $('#nestable-projet').nestable({
                        group: 1,
                        maxDepth: 4
                    }).on('change');
                    $('#nestable-client').nestable({
                        group: 1,
                        maxDepth: 4
                    }).on('change');

                    $('#btn-modifierTache').click(function() {
                        jQuery.fx.off = true;
                        $('#div-consulterTache').hide();
                        $('#div-modifierTache').show();
                        jQuery.fx.off = false;

                    });

                    $('#btn-fermer-modifierTache').click(function() {
                        jQuery.fx.off = true;
                        $('#div-consulterTache').show();
                        $('#div-modifierTache').hide();
                        jQuery.fx.off = false;

                    });

                    $('#btn-valider-modifierTache').click(function() {
                        jQuery.fx.off = true;
                        $('#div-consulterTache').show();
                        $('#div-modifierTache').hide();
                        jQuery.fx.off = false;

                    });

                    $('#btn-modifierTache-active').click(function() {
                        jQuery.fx.off = true;
                        $('#div-consulterTache').show();
                        $('#div-modifierTache').hide();
                        jQuery.fx.off = false;

                    });

                    $('#btn-projet-modifierTache').click(function() {
                        jQuery.fx.off = true;
                        $('#div-projet-consulterTache').hide();
                        $('#div-projet-modifierTache').show();
                        jQuery.fx.off = false;

                    });

                    $('#btn-projet-fermer-modifierTache').click(function() {
                        jQuery.fx.off = true;
                        $('#div-projet-consulterTache').show();
                        $('#div-projet-modifierTache').hide();
                        jQuery.fx.off = false;

                    });

                    $('#btn-projet-valider-modifierTache').click(function() {
                        jQuery.fx.off = true;
                        $('#div-projet-consulterTache').show();
                        $('#div-projet-modifierTache').hide();
                        jQuery.fx.off = false;

                    });

                    $('#btn-projet-modifierTache-active').click(function() {
                        jQuery.fx.off = true;
                        $('#div-projet-consulterTache').show();
                        $('#div-projet-modifierTache').hide();
                        jQuery.fx.off = false;

                    });

                    $('#datepicker_date_debut .input-group.date').datepicker({
                        todayBtn: "linked",
                        keyboardNavigation: false,
                        forceParse: false,
                        calendarWeeks: true,
                        autoclose: true,
                        language: "fr-FR"

                    });
                    $('#datepicker_date_fin_tot .input-group.date').datepicker({
                        todayBtn: "linked",
                        keyboardNavigation: false,
                        forceParse: false,
                        calendarWeeks: true,
                        autoclose: true,
                        language: "fr-FR"
                    });
                    $('#datepicker_date_fin_tard .input-group.date').datepicker({
                        todayBtn: "linked",
                        keyboardNavigation: false,
                        forceParse: false,
                        calendarWeeks: true,
                        autoclose: true,
                        language: "fr-FR"
                    });

                    $('#projet-tdb').slimScroll({
                        height: '130px'
                    });
                    $('#tache-tdb').slimScroll({
                        height: '130px'
                    });
                    $('#taches-retardes').slimScroll({
                        height: '130px'
                    });
                    $('#taches-proches').slimScroll({
                        height: '130px'
                    });
                    $('#taches-proposees').slimScroll({
                        height: '130px'
                    });
                    $('#bloc-notes-tdb').slimScroll({
                        height: '172px',
                        width: '100%'
                    });
                    $('.description-modal-tache').slimScroll({
                        height: '100px'
                    });

                    $('.list-task').slimScroll({
                        height: '90px'
                    });
                    $('.list-modif-client').slimScroll({
                        height: '130px'
                    });

                    $('.list-personnes-notifiees').slimScroll({
                        height: '85px'
                    });

                    $('[data-toggle="popover"]').popover();


                });

                $(document).on('click', '#submitButton', function(){
                    var $form = $('#addProjectForm');
                    var $serialize= $form.serialize();
                    var $value = $(".btn-active").attr('value');
                    jsRoutes.controllers.ProjetController.creerProjet().ajax({
                        data :$serialize+ '&priorite='+$value,
                        success : function(data) {
                            $("#errorCreerProjetP").empty();
                            $("#errorCreerProjet").hide();
                            $("#successCreerProjetP").html('@Messages("projet") '+data.nom+' @Messages("created")');
                            $("#successCreerProjet").show();
                            setTimeout(function(){
                                $("#successCreerProjet").hide();
                            },4000);
                            var projetList = $('#dataTables-admin-projet-body');
                            $("#dataTables-admin-projet").dataTable().fnDestroy();
                            var list = generateRowProjet(data);
                            projetList.append(list);

                            $("#addProjectForm")[0].reset();
                        },
                        error: function(errorMessage){
                            $("#successCreerProjet").hide();
                            $("#successCreerProjetP").empty();

                            var messageDiv = generateErrorCreerProjet(errorMessage);

                            $("#errorCreerProjetP").html(messageDiv);
                            $("#errorCreerProjet").show();
                        }
                    });

                });

                function generateRowProjet(projet)
                {
                    var list ="";
                    list+=('<tr class="table-center cursor-pointer" value="'+projet.id+'">');
                    list+=('<td style="vertical-align:middle ;">'+projet.nom+'</td>');
                    list+=('<td style="vertical-align:middle ;">'+projet.client.nom+'</td>');
                    list+=('<td style="vertical-align:middle ;"> </td>');
                    list+=('<td style="vertical-align:middle ;"> <p style="display:none ;"></p>');
                    list+=('<td style="vertical-align:middle;">@Messages("no")</td>');
                    if(projet.unite == "JOUR"){
                        list+=('<td class="td-avancement" style="vertical-align:middle ;">'+
                        '<p style="display:none ;">'+projet.avancementGlobal+'</p>'+
                        '<p class="row-initiale">@Messages("initial") :'+
                        projet.chargeInitiale+' @Messages("day-first-letter")</p> <p class="row-restante">@Messages("remaining")'+': '+projet.chargeRestante+
                        ' @Messages("day-first-letter")</p>');
                        list+=('<div class="progress progress-bar-default">');
                        if(projet.avancementGlobal == 0){
                            list+=('<div class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width:0%;color:black;"> 0% </div>');
                        }else{
                            list+=('<div class="progress-bar" role="progressbar" aria-valuenow="'+projet.avancementGlobal+'"aria-valuemin="0" aria-valuemax="100" style="width:'+projet.avancementGlobal+'% ;">'+ projet.avancementGlobal+'% </div>');
                        }
                        list+=('</div>');
                        list+=('<p class="row-consommee">'+'@Messages("consumed") : '+projet.chargeConsommee+'@Messages("day-first-letter") </p>');
                        list+=('</td>');
                    }else if(projet.unite == "SEMAINE"){
                        list+=('<td class="td-avancement" style="vertical-align:middle ;">'+
                        '<p style="display:none ;">'+projet.avancementGlobal+'</p>'+
                        '<p class="row-initiale">@Messages("initial") :'+
                        projet.chargeInitiale+' @Messages("week-first-letter")</p> <p class="row-restante">@Messages("remaining")'+':'+projet.chargeRestante+
                        ' @Messages("week-first-letter")</p>');
                        list+=('<div class="progress progress-bar-default">');
                        if(projet.avancementGlobal == 0){
                            list+=('<div class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width:0%;color:black;"> 0% </div>');
                        }else{
                            list+=('<div class="progress-bar" role="progressbar" aria-valuenow="'+projet.avancementGlobal+'"aria-valuemin="0" aria-valuemax="100" style="width:'+projet.avancementGlobal+'% ;">'+ projet.avancementGlobal+'% </div>');
                        }
                        list+=('</div>');
                        list+=('<p class="row-consommee">'+'@Messages("consumed")'+': '+projet.chargeConsommee+' @Messages("week-first-letter") </p>');
                        list+=('</td>');
                    }

                    list+=('<td class="td-btn-suppr" data-toggle="modal" data-target="#modal-confirmation-suppr-projet-admin" style="vertical-align:middle ;"><i class="fa fa-times"></i></td>');
                    list+=('</tr>');
                    return list;
                }
                function generateErrorCreerProjet(errorMessage)
                {
                    var messageDiv = '@Messages("errors") : ';

                    if(errorMessage.responseJSON.nomProjetVide==true)
                    {
                        messageDiv += '<br> - @Messages("nameProjetEmptyError")';
                    }
                    else if(errorMessage.responseJSON.nomProjetTropLong==true)
                    {
                        messageDiv += '<br> - @Messages("nameProjetTooLongError")';
                    }


                    if(errorMessage.responseJSON.dateThDebutProjetVide==true)
                    {
                        messageDiv += '<br> - @Messages("startDateEmptyError")';
                    }
                    if(errorMessage.responseJSON.dateThFinProjetVide==true)
                    {
                        messageDiv += '<br> - @Messages("endDateEmptyError")';
                    }

                    if(errorMessage.responseJSON.descriptionTropLong==true)
                    {
                        messageDiv += '<br> - @Messages("descriptionTooLongError")';
                    }


                    if(errorMessage.responseJSON.dateFinAvantDebut==true)
                    {
                        messageDiv += '<br> - @Messages("incoherentDate")';
                    }

                    if(errorMessage.responseJSON.parseError==true)
                    {
                        messageDiv += '<br> - @Messages("incoherentDate")';
                    }
                    return messageDiv;
                }
                $( document ).ajaxComplete(function() {

                    $("#errorCreerUser > button").click(function(){
                        $("#errorCreerUser").hide()
                    });

                    $("#errorCreerClient > button").click(function(){
                        $("#errorCreerClient").hide()
                    });

                    $("#errorCreerProjet > button").click(function(){
                        $("#errorProjet").hide()
                    });



                    $( "#btn-modifierProjet-admin" ).click(function() {
                        //$("#div-consulterProjet").css("display","none");

                        jQuery.fx.off = true;
                        $("#div-consulterProjet-admin").hide();
                        $("#div-modifierProjet-admin").show();
                        jQuery.fx.off = false;
                    });

                    $( "#btn-cancel-modifierProjet-admin" ).click(function() {
                        jQuery.fx.off = true;
                        $("#div-modifierProjet-admin").hide();
                        $("#div-consulterProjet-admin").show();
                        jQuery.fx.off = false;
                    });

                    $( "#btn-modifierProjet-client" ).click(function() {
                        //$("#div-consulterProjet").css("display","none");
                        jQuery.fx.off = true;
                        $("#div-consulterProjet-client").hide();
                        $("#div-modifierProjet-client").show();
                        jQuery.fx.off = false;
                    });

                    $( "#btn-cancel-modifierProjet-client" ).click(function() {
                        jQuery.fx.off = true;
                        $("#div-modifierProjet-client").hide();
                        $("#div-consulterProjet-client").show();
                        jQuery.fx.off = false;
                    });

                    $( "#btn-modifierProjet" ).click(function() {
                        //$("#div-consulterProjet").css("display","none");
                        var idProjet = $( "#btn-modifierProjet" ).attr("name");
                        jQuery.fx.off = true;
                        $("#div-consulterProjet-" + idProjet).hide();
                        $("#div-modifierProjet-" + idProjet).show();
                        jQuery.fx.off = false;
                    });

                    $( "#btn-cancel-modifierProjet" ).click(function() {
                        jQuery.fx.off = true;
                        var idProjet = $("#btn-cancel-modifierProjet").attr("name");
                        $("#div-modifierProjet-" + idProjet).hide();
                        $("#div-consulterProjet" + idProjet).show();
                        jQuery.fx.off = false;
                    });

                    $(".header-sidebar-projet").click(function(){

                        if($(this).next().is(":visible"))
                        {
                            next = $(this).next();
                            while (next!=null && next.hasClass("client-project"))
                            {
                                next.hide();
                                next = next.next();
                            }
                        }
                        else {
                            next = $(this).next();
                            while (next!=null && next.hasClass("client-project"))
                            {
                                next.show();
                                next = next.next();
                            }
                        }

                        $('.liste-projet-client').css('height',"100%");
                        height = $('.liste-projet-client').css('height');
                        height = parseInt(height);
                        height -= 200;
                        $('.liste-projet-client').css('height',height);

                    });

                    $( window ).resize(function() {
                        $('.liste-projet-client').css('height',"100%");
                        height = $('.liste-projet-client').css('height');
                        height = parseInt(height);
                        height -= 200;
                        $('.liste-projet-client').css('height',height);
                    });

                    $('.liste-projet-client').css('height',"100%");
                    height = $('.liste-projet-client').css('height');
                    height = parseInt(height);
                    height -= 200;
                    $('.liste-projet-client').css('height',height);


                    $('.sidebar-projet').click(function(){
                        var idProjet = '#' + $('.sidebar-projet.select').attr("name");
                        $('.sidebar-projet.select').removeClass("select");
                        $(idProjet).hide();
                        $(this).addClass("select");
                        var newIdProjet = '#' + $(this).attr("name");
                        $(newIdProjet).show();

                    });

                    $('#afficheListeProjet').click(function(){

                        if($("#col-sidebar-liste-projet").is(":visible")){
                            hideSideBarProjet();
                        }
                        else
                        {
                            showSideBarProjet();
                        }
                    });

                    $('#afficheRetour').click(function(){

                        if($("#col-sidebar-retour").is(":visible")){
                            hideSideBarRetour();
                        }
                        else
                        {
                            showSideBarRetour();
                        }
                    });

                    $( window ).resize(function() {
                        $('.liste-projet').css('height',"100%");
                        height = $('.liste-projet').css('height');
                        height = parseInt(height);
                        height -= 150;
                        $('.liste-projet').css('height',height);

                        /*if($(window).width()<1050){
                         hideSideBarProjet();
                         }
                         else {
                         showSideBarProjet();
                         }*/
                    });

                    function hideSideBarProjet()
                    {
                        $('#col-sidebar-liste-projet').hide();
                        $('#afficheListeProjet').css("width","25px");
                        $("#col-consulterProjet").removeClass("col-md-10");
                        $("#col-consulterProjet").addClass("col-md-12");
                        $("#icon-show-liste-projet").removeClass("fa-outdent");
                        $("#icon-show-liste-projet").addClass("fa-indent");
                    }
                    function showSideBarProjet()
                    {
                        $('#col-sidebar-liste-projet').show();
                        $('#afficheListeProjet').css("width","170px");
                        $("#col-consulterProjet").removeClass("col-md-12");
                        $("#col-consulterProjet").addClass("col-md-10");
                        $("#icon-show-liste-projet").removeClass("fa-indent");
                        $("#icon-show-liste-projet").addClass("fa-outdent");
                    }

                    function hideSideBarRetour()
                    {
                        $('#col-sidebar-retour').hide();
                        $('#afficheRetour').css("width","25px");
                        $("#col-consulterProjet").removeClass("col-md-10");
                        $("#col-consulterProjet").addClass("col-md-12");
                        $("#icon-show-liste-projet").removeClass("fa-outdent");
                        $("#icon-show-liste-projet").addClass("fa-indent");
                    }
                    function showSideBarRetour()
                    {
                        $('#col-sidebar-retour').show();
                        $('#afficheRetour').css("width","170px");
                        $("#col-consulterProjet").removeClass("col-md-12");
                        $("#col-consulterProjet").addClass("col-md-10");
                        $("#icon-show-liste-projet").removeClass("fa-indent");
                        $("#icon-show-liste-projet").addClass("fa-outdent");
                    }



                    $('.liste-projet').css('height',"100%");
                    height = $('.liste-projet').css('height');
                    height = parseInt(height);
                    height -= 150;
                    $('.liste-projet').css('height',height);


                    $(".select2-predecesseur").select2({
                        placeholder : '@Messages("choosePredecessor")...',
                        maximumSelectionLength: 1
                    });

                    $(".select2-successeur").select2({
                        placeholder : '@Messages("chooseSuccessor")...'
                    });
                    $(".select2-client").select2({
                        placeholder : '@Messages("chooseClient")...',
                        maximumSelectionLength: 1
                    });

                    $(".select2-respo-projet").select2({
                        placeholder : '@Messages("chooseProjectManager")...',
                        maximumSelectionLength: 1
                    });
                    $(".select2-respo-tache").select2({
                        placeholder : '@Messages("chooseTaskResponsible")...',
                        maximumSelectionLength: 1
                    });

                    $('#unite').select2({
                        minimumResultsForSearch: -1
                    });
                    $('#unite-projet').select2({
                        minimumResultsForSearch: -1
                    });

                    $('[data-toggle="popover"]').popover();
                    // activate Nestable for list 1

                    $('#nestable-projet').nestable({
                        group: 1,
                        maxDepth: 4
                    }).on('change');
                    $('#nestable-client').nestable({
                        group: 1,
                        maxDepth: 4
                    }).on('change');



                    $('.datatable-consulterClient').DataTable();
                    $('#dataTables-tdb-projet').DataTable();


                    $('#dataTables-tdb-tache').DataTable({
                        destroy:true,
                        "columnDefs": [{
                            "searchable": false,
                            "orderable": false,
                            "targets": [6, 7]
                        } ]
                    });

                    $('#dataTables-admin-user').DataTable({
                        destroy:true,
                        "columnDefs": [{
                            "searchable": false,
                            "orderable": false,
                            "targets":7,
                        } ]
                    });

                    $('#responsableProjet').select2();

                    $('#client').select2();

                    $('#responsableProjet-projet').select2();

                    $('#client-projet').select2();

                    $('.dataTables-example').DataTable();

                    $('#projet_Projet').dataTable( {
                        "ordering": false
                    } );

                    $('#dataTables-admin-projet').DataTable({
                        destroy: true,
                        "columnDefs": [{
                            "searchable": false,
                            "orderable": false,
                            "targets":6
                        } ]
                    });

                    $('#projet_Tache').dataTable( {
                        "ordering": false
                    } );


                    $('#dataTables-admin-client').DataTable({
                        destroy: true,
                        "columnDefs": [{
                            "searchable": false,
                            "orderable": false,
                            "targets":6
                        } ]
                    });




                    $('#btn-modifierTache').click(function() {
                        jQuery.fx.off = true;
                        $('#div-consulterTache').hide();
                        $('#div-modifierTache').show();
                        jQuery.fx.off = false;

                    });

                    $('#btn-fermer-modifierTache').click(function() {
                        jQuery.fx.off = true;
                        $('#div-consulterTache').show();
                        $('#div-modifierTache').hide();
                        jQuery.fx.off = false;

                    });

                    $('#btn-valider-modifierTache').click(function() {
                        jQuery.fx.off = true;
                        $('#div-consulterTache').show();
                        $('#div-modifierTache').hide();
                        jQuery.fx.off = false;

                    });

                    $('#btn-modifierTache-active').click(function() {
                        jQuery.fx.off = true;
                        $('#div-consulterTache').show();
                        $('#div-modifierTache').hide();
                        jQuery.fx.off = false;

                    });

                    $('#btn-projet-modifierTache').click(function() {
                        jQuery.fx.off = true;
                        $('#div-projet-consulterTache').hide();
                        $('#div-projet-modifierTache').show();
                        jQuery.fx.off = false;

                    });

                    $('#btn-projet-fermer-modifierTache').click(function() {
                        jQuery.fx.off = true;
                        $('#div-projet-consulterTache').show();
                        $('#div-projet-modifierTache').hide();
                        jQuery.fx.off = false;

                    });

                    $('#btn-projet-valider-modifierTache').click(function() {
                        jQuery.fx.off = true;
                        $('#div-projet-consulterTache').show();
                        $('#div-projet-modifierTache').hide();
                        jQuery.fx.off = false;

                    });

                    $('#btn-projet-modifierTache-active').click(function() {
                        jQuery.fx.off = true;
                        $('#div-projet-consulterTache').show();
                        $('#div-projet-modifierTache').hide();
                        jQuery.fx.off = false;

                    });

                    $('#datepicker_date_debut .input-group.date').datepicker({
                        format: 'dd/mm/yy',
                        todayBtn: "linked",
                        keyboardNavigation: false,
                        forceParse: false,
                        calendarWeeks: true,
                        autoclose: true,
                        language: "fr-FR"


                    });

                    $('#datepicker_date_fin_tot .input-group.date').datepicker({
                        format: 'dd/mm/yy',
                        todayBtn: "linked",
                        keyboardNavigation: false,
                        forceParse: false,
                        calendarWeeks: true,
                        autoclose: true,
                        language: "fr-FR",

                    });

                    $('#datepicker_date_fin_tard .input-group.date').datepicker({
                        format: 'dd/mm/yy',
                        todayBtn: "linked",
                        keyboardNavigation: false,
                        forceParse: false,
                        calendarWeeks: true,
                        autoclose: true,
                        language: "fr-FR"

                    });




                    $('#datepicker_projet_th_debut-projet .input-group.date').datepicker({
                        format: 'dd/mm/yy',
                        todayBtn: "linked",
                        keyboardNavigation: false,
                        forceParse: false,
                        calendarWeeks: true,
                        autoclose: true,
                        language: "fr-FR"

                    });

                    $('#datepicker_projet_th_fin-projet .input-group.date').datepicker({
                        format: 'dd/mm/yy',
                        todayBtn: "linked",
                        keyboardNavigation: false,
                        forceParse: false,
                        calendarWeeks: true,
                        autoclose: true,
                        language: "fr-FR"

                    });

                    $('#datepicker_projet_th_debut .input-group.date').datepicker({
                        //format: 'dd/mm/yyyy',
                        todayBtn: "linked",
                        keyboardNavigation: false,
                        forceParse: false,
                        calendarWeeks: true,
                        autoclose: true,
                        language: "fr"

                    });

                    $('#datepicker_projet_th_fin .input-group.date').datepicker({
                        //format: 'dd/mm/yyyy',
                        todayBtn: "linked",
                        keyboardNavigation: false,
                        forceParse: false,
                        calendarWeeks: true,
                        autoclose: true,
                        language: "fr"
                    });

                    $('#projet-tdb').slimScroll({
                        height: '130px'
                    });
                    $('#tache-tdb').slimScroll({
                        height: '130px'
                    });
                    $('#taches-retardes').slimScroll({
                        height: '130px'
                    });
                    $('#taches-proches').slimScroll({
                        height: '130px'
                    });
                    $('#taches-proposees').slimScroll({
                        height: '130px'
                    });
                    $('#bloc-notes-tdb').slimScroll({
                        height: '172px',
                        width: '100%'
                    });
                    $('.description-modal-tache').slimScroll({
                        height: '100px'
                    });

                    $('.list-task').slimScroll({
                        height: '90px'
                    });
                    $('.list-modif-client').slimScroll({
                        height: '130px'
                    });

                    $('.list-personnes-notifiees').slimScroll({
                        height: '85px'
                    });
                    /*
                     $('.table-suppr-user').slimScroll({
                     height: '300px'
                     });
                     */

                    $('.footable').footable();

                    // $('#modal-tdb-tache').modal();


                    function modeDraftProjet()
                    {
                        if($('#checkbox-draft-projet').is(':checked')){
                            $('#nestable-projet').removeClass("dd-nodrag");
                            $('.id-tache').hide();
                        }
                        else{
                            $('#nestable-projet').addClass("dd-nodrag");
                            $('.id-tache').show();
                        }
                    }
                    modeDraftProjet();
                    $('#checkbox-draft-projet').click(function() {
                        modeDraftProjet();
                    });

                    function modeDraftClient()
                    {
                        if($('#checkbox-draft-client').is(':checked')){
                            $('#nestable-client').removeClass("dd-nodrag");
                            $('.id-tache').hide();
                        }
                        else{
                            $('#nestable-client').addClass("dd-nodrag");
                            $('.id-tache').show();
                        }
                    }
                    modeDraftClient();
                    $('#checkbox-draft-client').click(function() {
                        modeDraftClient();
                    });

                    function modeDraftProjetAdmin()
                    {
                        if($('#checkbox-draft-projet-admin').is(':checked')){
                            $('#nestable-projet-admin').removeClass("dd-nodrag");
                            $('.id-tache').hide();
                        }
                        else{
                            $('#nestable-projet-admin').addClass("dd-nodrag");
                            $('.id-tache').show();
                        }
                    }
                    modeDraftProjetAdmin();
                    $('#checkbox-draft-projet-admin').click(function() {
                        modeDraftProjetAdmin();
                    });
                });

                $(document).on("hidden.bs.modal","#modal-add-client-admin",function(){
                    $("#contactFormCreerClient")[0].reset();
                    $("#creerClientForm")[0].reset();
                    $('#tableContact tr:not(:first)').remove();
                    $('#listContactAjout').hide();
                });

                $(document).on("shown.bs.modal","#modal-add-projet-admin",function(){
                    //init la selection de client et de projet
                    jsRoutes.controllers.AdminController.afficherModalCreerProjetResponsable().ajax({
                        success: function(listResponsable){
                            var responsablelist = $('#responsableProjet');
                            $(listResponsable).each(function(index, user) {
                                var list ="";
                                list+=('<option value='+user.id+'>'+user.prenom+' '+user.nom+'</option>');
                                responsablelist.append(list);
                            });
                        }
                    });
                    jsRoutes.controllers.AdminController.afficherModalCreerProjetClient().ajax({
                        success: function(listClient){
                            var clientlist = $('#client');
                            $(listClient).each(function(index, client) {
                                var list ="";
                                list+=('<option value='+client.id+'>'+client.nom+'</option>');
                                clientlist.append(list);
                            });
                        }
                    });
                });

                $(document).on("hidden.bs.modal","#modal-add-projet-admin",function(){
                    $("#addProjectForm")[0].reset();
                });

                $(document).on("hidden.bs.modal","#modal-add-user",function(){
                    $("#creerUserForm")[0].reset();
                });

                $(document).on('click','#dataTables-admin-projet-body tr td:last-child', function(){
                    var parent = $(this).parent('tr');
                    var idP = parent.attr('value');

                    jsRoutes.controllers.AdminController.afficherModalProjet(idP).ajax({
                        success: function(projet){
                            $("#modal-projet-admin-nom-projet").empty();
                            $("#modal-projet-admin-nom-projet").append(projet.nom);
                            $tmpTr = parent;
                        }
                    });
                });

                /* Afficher les Clients archivés */
                function clientsArchived(){
                    $('#checkBoxClientsArchived').change(function() {
                        if($(this).is(":checked")) {
                            console.log("CHECKED");
                            if(!$requestClientsArchives){
                                console.log("REQUESTCLIENT 1");
                                jsRoutes.controllers.AdminController.afficherClientsArchives().ajax({
                                    success : function(data) {
                                        var clientList = $('#dataTables-admin-client-body');
                                        console.log(data);
                                        $("#dataTables-admin-client").dataTable().fnDestroy();
                                        $(data).each(function(index, client) {
                                            var list ="";
                                            list+=('<tr class="archived" value='+client.id+'>');
                                            list+=('<td class="td-modal" data-toggle="modal" data-target="#modal-modif-client">'+client.nom+'</td>');
                                            list+=('<td class="td-modal" data-toggle="modal" data-target="#modal-modif-client">'+
                                            client.adresseClient.adresse+", "+client.adresseClient.zipCode+", "+client.adresseClient.ville+", "+client.adresseClient.pays+
                                            '</td>');
                                            list+=('<td class="td-modal" data-toggle="modal" data-target="#modal-modif-client">'+client.listContactsSize+'</td>');
                                            list+=('<td class="td-modal" data-toggle="modal" data-target="#modal-modif-client">'+client.listProjetsSize+'</td>');
                                            list+=('<td class="td-modal" data-toggle="modal" data-target="#modal-modif-client">'+client.listTachesSize+'</td>');
                                            list+=('<td class="td-modal" data-toggle="modal" data-target="#modal-modif-client">'+client.priorite+'</td>');
                                            list+=('<td class="td-modal" data-toggle="modal" data-target="#modal-modif-client">@Messages("yes")</td>');
                                            list+=('<td class="td-btn-suppr-disable" style="vertical-align:middle;" data-toggle="modal"><i class="fa fa-times"></i></td>');
                                            list+=('</tr>');

                                            clientList.append(list);
                                        });
                                    }
                                });
                                $requestClientsArchives = true;
                            }else{
                                $('.archived').show();
                            }
                        } else {
                            console.log("UNCHECKED");
                            $('.archived').hide();
                        }
                    });
                }

                /* Afficher les utilisateurs archivés */
                function utilisateursArchived(){
                    $('#checkboxUsersArchived').change(function() {
                        if($(this).is(":checked")) {
                            console.log("CHECKED");
                            if(!$requestUtilisateursArchives){

                                jsRoutes.controllers.AdminController.afficherUtilisateursArchives().ajax({
                                    success : function(data) {
                                        var utilisateurList = $('#dataTables-admin-user-body');
                                        console.log(data);
                                        $("#dataTables-admin-user").dataTable().fnDestroy();
                                        $(data).each(function(index, utilisateur) {
                                            var list ="";
                                            list+=('<tr class="archived" value='+utilisateur.id+'>');
                                            list+=('<td class="td-modal" data-toggle="modal" data-target="#modal-modif-user">'+utilisateur.nom+'</td>');
                                            list+=('<td class="td-modal" data-toggle="modal" data-target="#modal-modif-user">'+utilisateur.prenom+'</td>');
                                            list+=('<td class="td-modal" data-toggle="modal" data-target="#modal-modif-user">'+utilisateur.email+'</td>');
                                            list+=('<td class="td-modal" data-toggle="modal" data-target="#modal-modif-user">'+utilisateur.telephone+'</td>');
                                            list+=('<td class="td-modal" data-toggle="modal" data-target="#modal-modif-user">'+utilisateur.listProjetsResponsableSize+'</td>');
                                            list+=('<td class="td-modal" data-toggle="modal" data-target="#modal-modif-user">'+utilisateur.listTachesSize+'</td>');
                                            list+=('<td class="td-modal" data-toggle="modal" data-target="#modal-modif-user">@Messages("yes")</td>');
                                            list+=('<td class="td-btn-suppr-disable" style="vertical-align:middle; cursor:no-drop;" data-toggle="modal" disabled><i class="fa fa-times"></i></td>');
                                            list+=('</tr>');

                                            utilisateurList.append(list);
                                        });
                                    }
                                });

                                $requestUtilisateursArchives = true;
                            }else{
                                $('.archived').show();
                            }
                        } else {
                            console.log("UNCHECKED");
                            $('.archived').hide();
                        }
                    });
                }

                function reverse(string){
                    if(string===null){
                        return "";
                    }else{
                        var res =  string.split('/');
                        var final = res[2] + '/' + res[1] + '/' + res[0];
                        return final;
                    }

                }

                function verif(string){
                    if(string === null){
                        return "";
                    }else{
                        return string;
                    }
                }
                //TODO : changer pour la partie consommee
                function projetTermines(){
                    $('#checkbox-projet-admin-projets-termines').change(function() {
                        if($(this).is(":checked")) {
                            /* var str;
                             if($('#checkbox-projet-admin-projets-archives').is(":checked")) {
                             str = "jsRoutes.controllers.AdminController.afficherProjetsTermines(true)";
                             $requestProjetsTermines = false;
                             }else{
                             str = "jsRoutes.controllers.AdminController.afficherProjetsTermines(false)";
                             $requestProjetsTermines = false;
                             }*/
                            var str = "jsRoutes.controllers.AdminController.afficherProjetsTermines(false)";
                            if(!$requestProjetsTermines){
                                eval(str).ajax({
                                    success : function(data) {
                                        alert(data);
                                        var projetList = $('#dataTables-admin-projet-body');
                                        $("#dataTables-admin-projet").dataTable().fnDestroy();
                                        $(data).each(function(index, projet) {

                                            var list ="";
                                            list+=('<tr class="table-center cursor-pointer projetTermines" value="'+projet.id+'">');
                                            list+=('<td style="vertical-align:middle ;">'+projet.nom+'</td>');
                                            list+=('<td style="vertical-align:middle ;">'+projet.client.nom+'</td>');
                                            list+=('<td style="vertical-align:middle ;">'+verif(projet.dateDebutReel)+'</td>');
                                            list+=('<td style="vertical-align:middle ;"> <p style="display:none ;">'+reverse(projet.dateFinReelTot)+'</p>'
                                            +'<p>'+verif(projet.dateFinReelTot)+'</p>'
                                            +'<p>'+verif(projet.dateFinReelTard)+'</p>')
                                            if(projet.archive){
                                                list+=('<td style="vertical-align:middle;">@Messages("yes")</td>');
                                            }else{
                                                list+=('<td style="vertical-align:middle;">@Messages("no")</td>');
                                            }
                                            if(projet.unite == "JOUR"){
                                                list+=('<td class="td-avancement" style="vertical-align:middle ;">'+
                                                '<p style="display:none ;">'+projet.avancementGlobal+'</p>'+
                                                '<p class="row-initiale">@Messages("initial") :'+
                                                projet.chargeInitiale+' @Messages("day-first-letter")</p> <p class="row-restante">@Messages("remaining") : '+projet.chargeRestante+
                                                ' @Messages("day-first-letter")</p>');
                                                list+=('<div class="progress progress-bar-default">');
                                                if(projet.avancementGlobal == 0){
                                                    list+=('<div class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width:0%;color:black;"> 0% </div>');
                                                }else{
                                                    list+=('<div class="progress-bar" role="progressbar" aria-valuenow="'+projet.avancementGlobal+'"aria-valuemin="0" aria-valuemax="100" style="width:'+projet.avancementGlobal+'% ;">'+ projet.avancementGlobal+'% </div>');
                                                }
                                                list+=('</div>');
                                                list+=('<p class="row-consommee">'+'@Messages("consumed") : '+projet.chargeConsomee+' @Messages("day-first-letter") </p>');
                                                list+=('</td>');
                                            }else if(projet.unite == "SEMAINE"){
                                                list+=('<td class="td-avancement" style="vertical-align:middle ;">'+
                                                '<p style="display:none ;">'+projet.avancementGlobal+'</p>'+
                                                '<p class="row-initiale">@Messages("initial") :'+
                                                projet.chargeInitiale+' @Messages("week-first-letter")</p> <p class="row-restante">@Messages("remaining") : '+projet.chargeRestante+
                                                ' @Messages("week-first-letter")</p>');
                                                list+=('<div class="progress progress-bar-default">');
                                                if(projet.avancementGlobal == 0){
                                                    list+=('<div class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width:0%;color:black;"> 0% </div>');
                                                }else{
                                                    list+=('<div class="progress-bar" role="progressbar" aria-valuenow="'+projet.avancementGlobal+'"aria-valuemin="0" aria-valuemax="100" style="width:'+projet.avancementGlobal+'% ;">'+ projet.avancementGlobal+'% </div>');
                                                }
                                                list+=('</div>');
                                                list+=('<p class="row-consommee">'+'@Messages("consumed") : '+projet.chargeConsomee+' @Messages("week-first-letter") </p>');
                                                list+=('</td>');
                                            }
                                            list+=('<td class="td-btn-suppr" data-toggle="modal" data-target="#modal-confirmation-suppr-projet-admin" style="vertical-align:middle ;"><i class="fa fa-times"></i></td>');
                                            list+=('</tr>');
                                            projetList.append(list);
                                        });
                                    }
                                });
                                $requestProjetsTermines = true;
                            }else{
                                $('.projetTermines').show();
                            }
                        } else {

                            $('.projetTermines').hide();
                        }
                    });


                }

                function projetArchives(){
                    $('#checkbox-projet-admin-projets-archives').change(function() {
                        if($(this).is(":checked")) {
                            /*var str;
                             if($('#checkbox-projet-admin-projets-termines').is(":checked")) {
                             str = "jsRoutes.controllers.AdminController.afficherProjetsArchives(true)";
                             $requestProjetsArchives = false;
                             }else{
                             str = "jsRoutes.controllers.AdminController.afficherProjetsArchives(false)";
                             $requestProjetsArchives = false;
                             }*/
                            var str = "jsRoutes.controllers.AdminController.afficherProjetsArchives(false)";
                            if(!$requestProjetsArchives){
                                jsRoutes.controllers.AdminController.afficherProjetsArchives(false).ajax({
                                    success : function(data) {
                                        var projetList = $('#dataTables-admin-projet-body');
                                        $("#dataTables-admin-projet").dataTable().fnDestroy();
                                        $(data).each(function(index, projet) {
                                            var list ="";
                                            list+=('<tr class="table-center cursor-pointer projetArchives" value="'+projet.id+'">');
                                            list+=('<td style="vertical-align:middle ;">'+projet.nom+'</td>');
                                            list+=('<td style="vertical-align:middle ;">'+projet.client.nom+'</td>');
                                            list+=('<td style="vertical-align:middle ;">'+verif(projet.dateDebutReel)+'</td>');
                                            list+=('<td style="vertical-align:middle ;"> <p style="display:none ;">'+reverse(projet.dateFinReelTot)+'</p>'
                                            +'<p>'+verif(projet.dateFinReelTot)+'</p>'
                                            +'<p>'+verif(projet.dateFinReelTard)+'</p>')
                                            if(projet.archive){
                                                list+=('<td style="vertical-align:middle;">@Messages("yes")</td>');
                                            }else{
                                                list+=('<td style="vertical-align:middle;">@Messages("no")</td>');
                                            }
                                            if(projet.unite == "JOUR"){
                                                list+=('<td class="td-avancement" style="vertical-align:middle ;">'+
                                                '<p style="display:none ;">'+projet.avancementGlobal+'</p>'+
                                                '<p class="row-initiale">@Messages("initial") :'+
                                                projet.chargeInitiale+' @Messages("day-first-letter")</p> <p class="row-restante">@Messages("remaining") :'+projet.chargeRestante+
                                                ' @Messages("day-first-letter")</p>');
                                                list+=('<div class="progress progress-bar-default">');
                                                if(projet.avancementGlobal == 0){
                                                    list+=('<div class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width:0%;color:black;"> 0% </div>');
                                                }else{
                                                    list+=('<div class="progress-bar" role="progressbar" aria-valuenow="'+projet.avancementGlobal+'"aria-valuemin="0" aria-valuemax="100" style="width:'+projet.avancementGlobal+'% ;">'+ projet.avancementGlobal+'% </div>');
                                                }
                                                list+=('</div>');
                                                list+=('<p class="row-consommee">'+'@Messages("consumed") : '+projet.chargeConsommee+' @Messages("day-first-letter") </p>');
                                                list+=('</td>');
                                            }else if(projet.unite == "SEMAINE"){
                                                list+=('<td class="td-avancement" style="vertical-align:middle ;">'+
                                                '<p style="display:none ;">'+projet.avancementGlobal+'</p>'+
                                                '<p class="row-initiale">@Messages("initial") :'+
                                                projet.chargeInitiale+' @Messages("week-first-letter")</p> <p class="row-restante">@Messages("remaining") : '+projet.chargeRestante+
                                                ' @Messages("week-first-letter")</p>');
                                                list+=('<div class="progress progress-bar-default">');
                                                if(projet.avancementGlobal == 0){
                                                    list+=('<div class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width:0%;color:black;"> 0% </div>');
                                                }else{
                                                    list+=('<div class="progress-bar" role="progressbar" aria-valuenow="'+projet.avancementGlobal+'"aria-valuemin="0" aria-valuemax="100" style="width:'+projet.avancementGlobal+'% ;">'+ projet.avancementGlobal+'% </div>');
                                                }
                                                list+=('</div>');
                                                list+=('<p class="row-consommee">'+'@Messages("consumed") : '+projet.chargeConsommee+' @Messages("week-first-letter") </p>');
                                                list+=('</td>');
                                            }
                                            list+=('<td class="td-btn-suppr-disable" style="vertical-align:middle; cursor:no-drop;" data-toggle="modal" disabled><i class="fa fa-times"></i></td>');
                                            list+=('</tr>');
                                            projetList.append(list);
                                        });
                                    }
                                });
                                $requestProjetsArchives = true;
                            }else{
                                $('.projetArchives').show();
                            }
                        } else {
                            $('.projetArchives').hide();
                        }
                    });
                }
        </script>
    </body>
</html>